!function(d){function i(e){e._nonce=cartflows_offer[e.action+"_nonce"],d.ajax({url:cartflows.ajax_url,data:e,dataType:"json",type:"POST",success:function(e){var t=e.message,o="wcf-payment-"+e.status;d("body").trigger("wcf-update-msg",[t,o]),setTimeout(function(){window.location.href=e.redirect},500)}})}d(document).ready(function(a){a("body").on("wcf-show-loader",function(e,t){"no"===t&&(jQuery(".wcf-note-yes").hide(),jQuery(".wcf-note-no").show()),a(".wcf-loader-bg").addClass("show")}),a("body").on("wcf-hide-loader",function(e){a(".wcf-loader-bg").removeClass("show")}),a("body").on("wcf-update-msg",function(e,t,o){a(".wcf-order-msg .wcf-process-msg").text(t).addClass(o)}),d('a[href*="wcf-up-offer"], a[href*="wcf-down-offer"]').each(function(e){var t=d(this),o=t.attr("href");-1!==o.indexOf("wcf-up-offer-yes")&&t.attr("id","wcf-upsell-offer"),-1!==o.indexOf("wcf-down-offer-yes")&&t.attr("id","wcf-downsell-offer")}),d(document).on("click",'a[href*="wcf-up-offer"], a[href*="wcf-down-offer"]',function(e){e.preventDefault();var t=d(this).attr("href"),o="yes",a="upsell",r=cartflows_offer.step_id,n=cartflows_offer.product_id,c=cartflows_offer.order_id,f=cartflows_offer.order_key;if(-1!==t.indexOf("wcf-up-offer")&&(a="upsell",o=-1!==t.indexOf("wcf-up-offer-yes")?"yes":"no"),-1!==t.indexOf("wcf-down-offer")&&(a="downsell",o=-1!==t.indexOf("wcf-down-offer-yes")?"yes":"no"),"yes"!==cartflows_offer.skip_offer||"yes"!==o){d("body").trigger("wcf-show-loader",o),action="yes"===o?"wcf_"+a+"_accepted":"wcf_"+a+"_rejected";var s={action:"",offer_action:o,offer_type:a,step_id:r,product_id:n,order_id:c,order_key:f,stripe_sca_payment:!1,stripe_intent_id:"",_nonce:""};return"stripe"===cartflows_offer.payment_method&&"yes"===o?(s.action="wcf_stripe_sca_check",s._nonce=cartflows_offer.wcf_stripe_sca_check_nonce,d.ajax({url:cartflows.ajax_url,data:s,dataType:"json",type:"POST",success:function(e){e.hasOwnProperty("intent_secret")?Stripe(e.stripe_pk).handleCardPayment(e.intent_secret).then(function(e){if(e.error)throw e.error;"requires_capture"!==e.paymentIntent.status&&"succeeded"!==e.paymentIntent.status||(s.action=action,s.stripe_sca_payment=!0,s.stripe_intent_id=e.paymentIntent.id,i(s))}).catch(function(e){window.location.reload()}):(s.action=action,i(s))}})):(s.action=action,i(s)),!1}}),d(document).on("click",".wcf-upsell-offer, .wcf-downsell-offer",function(e){e.preventDefault();var t=d(this),o=t.data("action"),a="upsell",r=t.data("step"),n=t.data("product"),c=t.data("order"),f=t.data("order_key");if(!t.hasClass("cartflows-skip")||"yes"!==o)return d("body").trigger("wcf-show-loader",o),t.hasClass("wcf-downsell-offer")&&(a="downsell"),action="yes"===o?"wcf_"+a+"_accepted":"wcf_"+a+"_rejected",d.ajax({url:cartflows.ajax_url,data:{action:action,offer_action:o,step_id:r,product_id:n,order_id:c,order_key:f},dataType:"json",type:"POST",success:function(e){var t=e.message,o="wcf-payment-"+e.status;d("body").trigger("wcf-update-msg",[t,o]),setTimeout(function(){window.location.href=e.redirect},500)}}),!1}),"1"!==cartflows.is_pb_preview&&(jQuery(document).ajaxComplete(function(e,t,o){if(t.hasOwnProperty("responseJSON")){var a=t.responseJSON.hasOwnProperty("fragments")?t.responseJSON.fragments:null;a&&a.hasOwnProperty("added_to_cart_data")&&fbq("track","AddToCart",a.added_to_cart_data.added_to_cart)}}),jQuery(document).ajaxComplete(function(e,t,o){if(t.hasOwnProperty("responseJSON")){var a=cartflows.wcf_ga_active.google_analytics_id,r=cartflows.wcf_ga_active.enable_add_to_cart;if("1"===cartflows.is_checkout_page&&"enable"===r){var n=t.responseJSON.hasOwnProperty("fragments")?t.responseJSON.fragments:null;if(o.hasOwnProperty("data")&&-1!==o.data.indexOf("action=wcf_bump_order_process")){if(n&&n.hasOwnProperty("ga_added_to_cart_data")){var c={send_to:a,event_category:"ecommerce",items:[n.ga_added_to_cart_data.add_to_cart],non_interaction:!0};gtag("event","add_to_cart",c)}n&&n.hasOwnProperty("ga_remove_to_cart_data")&&(c={send_to:a,event_category:"ecommerce",items:[n.ga_remove_to_cart_data.remove_from_cart],non_interaction:!0},gtag("event","remove_from_cart",c))}}}}))})}(jQuery);